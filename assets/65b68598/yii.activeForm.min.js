!function(t){t.fn.yiiActiveForm=function(i){return s[i]?s[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?(t.error("Method "+i+" does not exist on jQuery.yiiActiveForm"),!1):s.init.apply(this,arguments)};var i,e={beforeValidate:"beforeValidate",afterValidate:"afterValidate",beforeValidateAttribute:"beforeValidateAttribute",afterValidateAttribute:"afterValidateAttribute",beforeSubmit:"beforeSubmit",ajaxBeforeSend:"ajaxBeforeSend",ajaxComplete:"ajaxComplete",afterInit:"afterInit"},a={encodeErrorSummary:!0,errorSummary:".error-summary",validateOnSubmit:!0,errorCssClass:"has-error",successCssClass:"has-success",validatingCssClass:"validating",ajaxParam:"ajax",ajaxDataType:"json",validationUrl:void 0,scrollToError:!0,scrollToErrorOffset:0,validationStateOn:"container"},r={id:void 0,name:void 0,container:void 0,input:void 0,error:".help-block",encodeError:!0,validateOnChange:!0,validateOnBlur:!0,validateOnType:!1,validationDelay:500,enableAjaxValidation:!1,validate:void 0,status:0,cancelled:!1,value:void 0,updateAriaInvalid:!0},n=function(t){i&&(i.resolve(),i=void 0,t.removeData("yiiSubmitFinalizePromise"))},s={init:function(i,n){return this.each(function(){var u=t(this);if(!u.data("yiiActiveForm")){var d=t.extend({},a,n||{});void 0===d.validationUrl&&(d.validationUrl=u.attr("action")),t.each(i,function(e){i[e]=t.extend({value:b(u,this)},r,this),o(u,i[e])}),u.data("yiiActiveForm",{settings:d,attributes:i,submitting:!1,validated:!1,options:v(u)}),u.on("reset.yiiActiveForm",s.resetForm),d.validateOnSubmit&&(u.on("mouseup.yiiActiveForm keyup.yiiActiveForm",":submit",function(){u.data("yiiActiveForm").submitObject=t(this)}),u.on("submit.yiiActiveForm",s.submitForm));var l=t.Event(e.afterInit);u.trigger(l)}})},add:function(i){var e=t(this);i=t.extend({value:b(e,i)},r,i),e.data("yiiActiveForm").attributes.push(i),o(e,i)},remove:function(i){var e=t(this),a=e.data("yiiActiveForm").attributes,r=-1,n=void 0;return t.each(a,function(t){if(a[t].id==i)return r=t,n=a[t],!1}),r>=0&&(a.splice(r,1),u(e,n)),n},validateAttribute:function(i){var e=s.find.call(this,i);void 0!=e&&d(t(this),e,!0)},find:function(i){var e=t(this).data("yiiActiveForm").attributes,a=void 0;return t.each(e,function(t){if(e[t].id==i)return a=e[t],!1}),a},destroy:function(){return this.each(function(){t(this).off(".yiiActiveForm"),t(this).removeData("yiiActiveForm")})},data:function(){return this.data("yiiActiveForm")},validate:function(i){i&&(t(this).data("yiiActiveForm").submitting=!0);var a=t(this),r=a.data("yiiActiveForm"),s=!1,o={},u=l(),d=r.submitting;if(d){var c=t.Event(e.beforeValidate);if(a.trigger(c,[o,u]),!1===c.result)return r.submitting=!1,void n(a)}t.each(r.attributes,function(){this.$form=a;var i=y(a,this);if(i.is(":disabled"))return!0;if(i.length&&"select"===i[0].tagName.toLowerCase()){if(!i[0].options.length)return!0;if(1===i[0].options.length&&""===i[0].options[0].value)return!0}if(this.cancelled=!1,r.submitting||2===this.status||3===this.status){var n=o[this.id];void 0===n&&(n=[],o[this.id]=n);var d=t.Event(e.beforeValidateAttribute);a.trigger(d,[this,n,u]),!1!==d.result?(this.validate&&this.validate(this,b(a,this),n,u,a),this.enableAjaxValidation&&(s=!0)):this.cancelled=!0}}),t.when.apply(this,u).always(function(){for(var i in o)0===o[i].length&&delete o[i];if(s&&(t.isEmptyObject(o)||r.submitting)){var u=r.submitObject,l="&"+r.settings.ajaxParam+"="+a.attr("id");u&&u.length&&u.attr("name")&&(l+="&"+u.attr("name")+"="+u.attr("value")),t.ajax({url:r.settings.validationUrl,type:a.attr("method"),data:a.serialize()+l,dataType:r.settings.ajaxDataType,complete:function(t,i){a.trigger(e.ajaxComplete,[t,i])},beforeSend:function(t,i){a.trigger(e.ajaxBeforeSend,[t,i])},success:function(i){null!==i&&"object"==typeof i?(t.each(r.attributes,function(){this.enableAjaxValidation&&!this.cancelled||delete i[this.id]}),f(a,t.extend(o,i),d)):f(a,o,d)},error:function(){r.submitting=!1,n(a)}})}else r.submitting?window.setTimeout(function(){f(a,o,d)},200):f(a,o,d)})},submitForm:function(){var a=t(this),r=a.data("yiiActiveForm");if(r.validated){r.submitting=!1;var o=t.Event(e.beforeSubmit);return a.trigger(o),!1===o.result?(r.validated=!1,n(a),!1):(h(a),!0)}return function(e){i=t.Deferred(),e.data("yiiSubmitFinalizePromise",i.promise())}(a),void 0!==r.settings.timer&&clearTimeout(r.settings.timer),r.submitting=!0,s.validate.call(a),!1},resetForm:function(){var i=t(this),e=i.data("yiiActiveForm");window.setTimeout(function(){t.each(e.attributes,function(){this.value=b(i,this),this.status=0;var t=i.find(this.container),a=y(i,this);("input"===e.settings.validationStateOn?a:t).removeClass(e.settings.validatingCssClass+" "+e.settings.errorCssClass+" "+e.settings.successCssClass),t.find(this.error).html("")}),i.find(e.settings.errorSummary).hide().find("ul").html("")},1)},updateMessages:function(i,e){var a=t(this),r=a.data("yiiActiveForm");t.each(r.attributes,function(){m(a,this,i)}),e&&g(a,i)},updateAttribute:function(i,e){var a=s.find.call(this,i);if(void 0!=a){var r={};r[i]=e,m(t(this),a,r)}}},o=function(i,e){var a=y(i,e);e.validateOnChange&&a.on("change.yiiActiveForm",function(){d(i,e,!1)}),e.validateOnBlur&&a.on("blur.yiiActiveForm",function(){0!=e.status&&1!=e.status||d(i,e,!0)}),e.validateOnType&&a.on("keyup.yiiActiveForm",function(a){-1===t.inArray(a.which,[16,17,18,37,38,39,40])&&e.value!==b(i,e)&&d(i,e,!1,e.validationDelay)})},u=function(t,i){y(t,i).off(".yiiActiveForm")},d=function(i,e,a,r){var n=i.data("yiiActiveForm");a&&(e.status=2),t.each(n.attributes,function(){this.value!==b(i,this)&&(this.status=2,a=!0)}),a&&(void 0!==n.settings.timer&&clearTimeout(n.settings.timer),n.settings.timer=window.setTimeout(function(){n.submitting||i.is(":hidden")||(t.each(n.attributes,function(){2===this.status&&(this.status=3,i.find(this.container).addClass(n.settings.validatingCssClass))}),s.validate.call(i))},r||200))},l=function(){var i=[];return i.add=function(i){this.push(new t.Deferred(i))},i},c=["action","target","method","enctype"],v=function(t){for(var i={},e=0;e<c.length;e++)i[c[e]]=t.attr(c[e]);return i},f=function(i,a,r){var s=i.data("yiiActiveForm");if(void 0===s)return!1;if(r){var o=[],u=y(i,this);if(t.each(s.attributes,function(){u.is(":disabled")||this.cancelled||!m(i,this,a)||o.push(this)}),i.trigger(e.afterValidate,[a,o]),g(i,a),o.length){if(s.settings.scrollToError){var d=i.find(t.map(o,function(t){return t.input}).join(",")).first().closest(":visible").offset().top-s.settings.scrollToErrorOffset;d<0?d=0:d>t(document).height()&&(d=t(document).height());var l=t(window).scrollTop();(d<l||d>l+t(window).height())&&t(window).scrollTop(d)}s.submitting=!1}else s.validated=!0,s.submitObject&&function(t,i){for(var e=0;e<c.length;e++){var a=i.attr("form"+c[e]);a&&t.attr(c[e],a)}}(i,s.submitObject),i.submit(),s.submitObject&&function(t){for(var i=t.data("yiiActiveForm"),e=0;e<c.length;e++)t.attr(c[e],i.options[c[e]]||null)}(i)}else t.each(s.attributes,function(){this.cancelled||2!==this.status&&3!==this.status||m(i,this,a)});n(i)},h=function(i){var e=i.data("yiiActiveForm").submitObject||i.find(":submit:first");if(e.length&&"submit"==e.attr("type")&&e.attr("name")){var a=t('input[type="hidden"][name="'+e.attr("name")+'"]',i);a.length?a.attr("value",e.attr("value")):t("<input>").attr({type:"hidden",name:e.attr("name"),value:e.attr("value")}).appendTo(i)}},m=function(i,a,r){var n=i.data("yiiActiveForm"),s=y(i,a),o=!1;if(t.isArray(r[a.id])||(r[a.id]=[]),a.status=1,s.length){o=r[a.id].length>0;var u=i.find(a.container),d=u.find(a.error);p(i,a,o);var l="input"===n.settings.validationStateOn?s:u;o?(a.encodeError?d.text(r[a.id][0]):d.html(r[a.id][0]),l.removeClass(n.settings.validatingCssClass+" "+n.settings.successCssClass).addClass(n.settings.errorCssClass)):(d.empty(),l.removeClass(n.settings.validatingCssClass+" "+n.settings.errorCssClass+" ").addClass(n.settings.successCssClass)),a.value=b(i,a)}return i.trigger(e.afterValidateAttribute,[a,r[a.id]]),o},g=function(i,e){var a=i.data("yiiActiveForm"),r=i.find(a.settings.errorSummary),n=r.find("ul").empty();r.length&&e&&(t.each(a.attributes,function(){if(t.isArray(e[this.id])&&e[this.id].length){var i=t("<li/>");a.settings.encodeErrorSummary?i.text(e[this.id][0]):i.html(e[this.id][0]),n.append(i)}}),r.toggle(n.find("li").length>0))},b=function(t,i){var e=y(t,i),a=e.attr("type");if("checkbox"===a||"radio"===a){var r=e.filter(":checked");return r.length||(r=t.find('input[type=hidden][name="'+e.attr("name")+'"]')),r.val()}return e.val()},y=function(t,i){var e=t.find(i.input);return e.length&&"div"===e[0].tagName.toLowerCase()?e.find("input"):e},p=function(t,i,e){i.updateAriaInvalid&&t.find(i.input).attr("aria-invalid",e?"true":"false")}}(window.jQuery);